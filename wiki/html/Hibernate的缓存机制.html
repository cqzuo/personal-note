<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=gbk" /> 
        <title>Hibernate的缓存机制</title>
        <meta id="viewport" name="viewport" 
            content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" /> 
        <link rel="stylesheet" href="style.css" /> 
        <link rel="apple-touch-icon" href="../images/apple-touch-icon.png" /> 
		<link type="text/css" rel="stylesheet" href="../SyntaxHighlighter/Styles/SyntaxHighlighter.css"></link> 
		<script class="javascript" src="../SyntaxHighlighter/Scripts/shCore.js"></script> 
		<script class="javascript" src="../SyntaxHighlighter/Scripts/shBrushCSharp.js"></script> 
		<script class="javascript" src="../SyntaxHighlighter/Scripts/shBrvushPhp.js"></script> 
		<script class="javascript" src="../SyntaxHighlighter/Scripts/shBrushJScript.js"></script> 
		<script class="javascript" src="../SyntaxHighlighter/Scripts/shBrushJava.js"></script> 
		<script class="javascript" src="../SyntaxHighlighter/Scripts/shBrushVb.js"></script> 
		<script class="javascript" src="../SyntaxHighlighter/Scripts/shBrushSql.js"></script> 
		<script class="javascript" src="../SyntaxHighlighter/Scripts/shBrushXml.js"></script> 
		<script class="javascript" src="../SyntaxHighlighter/Scripts/shBrushDelphi.js"></script> 
		<script class="javascript" src="../SyntaxHighlighter/Scripts/shBrushPython.js"></script> 
		<script class="javascript" src="../SyntaxHighlighter/Scripts/shBrushRuby.js"></script> 
		<script class="javascript" src="../SyntaxHighlighter/Scripts/shBrushCss.js"></script> 
		<script class="javascript" src="../SyntaxHighlighter/Scripts/shBrushCpp.js"></script> 
		
		<link type="text/css" rel="stylesheet" href="../SyntaxHighlighter/styles/shCoreDefault.css"/> 
		<script type="text/javascript">SyntaxHighlighter.all();</script> 

		<script type="text/javascript" charset="utf-8"> 
            window.onload = function() {
                var header = document.getElementById('header').getElementsByTagName('h1')[0],
                    old = document.getElementById('content').getElementsByTagName('h1')[0];
                if (old) header.innerHTML = old.innerHTML;
                setTimeout(function(){
                    window.scrollTo(0, 1);
                }, 100);
            }
        </script>
    </head>
    <body>
        <div id="header">
            <a href="index.html" id="backButton">Index</a><!--<center><h1>Hibernate的缓存机制</h1></center> -->
        </div>
        <div id="content">
<p>
缓存是位于应用程序与物理数据源之间，用于临时存放复制数据的内存区域，目的是为了减少应用程序对物理数据源访问的次数，从而提高应用程序的运行性能. 
  Hibernate在查询数据时，首先到缓存中去查找，如果找到就直接使用，找不到的时候就会从物理数据源中检索，所以，把频繁使用的数据加载到缓存区后，就可以大大减少应用程序对物理数据源的访问，使得程序的运行性能明显的提升. 
</p>
  
<p>
Hibernate缓存分类： 
</p>

<p>
Session缓存，一级缓存. 
</p>

<p>
<a href="SessionFactory.html">SessionFactory</a>的缓存分为内置缓存和外置缓存.内置缓存中存放的是<a href="SessionFactory.html">SessionFactory</a>对象的一些集合属性包含的数据(映射元素据及预定义SQL语句等),对于应用程序来说,它是只读的.外置缓存中存放的是数据库数据的副本,其作用和一级缓存类似.二级缓存除了以内存作为存储介质外,还可以选用硬盘等外部存储设备. 
</p>

<p>
Hibernate的缓存范围 
</p>

<p>
Hibernate的一级缓存和二级缓存都位于均位于持久层,且均用于存放数据库数据的副本,最大的区别就是缓存的范围各不一样. 
</p>

<p>
缓存的范围分为3类: 
</p>

<p>
1.事务范围 
   事务范围的缓存只能被当前事务访问,每个事务都有各自的缓存,缓存内的数据通常采用相互关联的对象形式.缓存的生命周期依赖于事务的生命周期,只有当事务结束时,缓存的生命周期才会结束.事务范围的缓存使用内存作为存储介质,一级缓存就属于事务范围. 
2.应用范围 
   应用程序的缓存可以被应用范围内的所有事务共享访问.缓存的生命周期依赖于应用的生命周期,只有当应用结束时,缓存的生命周期才会结束.应用范围的缓存可以使用内存或硬盘作为存储介质,二级缓存就属于应用范围. 
3.集群范围 
   在集群环境中,缓存被一个机器或多个机器的进程共享,缓存中的数据被复制到集群环境中的每个进程节点,进程间通过远程通信来保证缓存中的数据的一致,缓存中的数据通常采用对象的松散数据形式. 
</p>

<p>
  Hibernate的缓存管理 
</p>

<p>
一级缓存的管理: 
</p>

<p>
  evit(Object obj)  将指定的持久化对象从一级缓存中清除,释放对象所占用的内存资源,指定对象从持久化状态变为脱管状态,从而成为游离对象. 
  clear()  将一级缓存中的所有持久化对象清除,释放其占用的内存资源 
  contains(Object obj) 判断指定的对象是否存在于一级缓存中. 
  flush() 刷新一级缓存区的内容,使之与数据库数据保持同步. 
</p>

<p>
  二级缓存的管理: 
</p>
   
<p>
   evict(Class arg0, Serializable arg1)  将某个类的指定ID的持久化对象从二级缓存中清除,释放对象所占用的资源. 
</p>
   
<p>
Java代码 
1.sessionFactory.evict(Customer.class, new Integer(1));  
sessionFactory.evict(Customer.class, new Integer(1));
   evict(Class arg0)  将指定类的所有持久化对象从二级缓存中清除,释放其占用的内存资源. 
</p>
   
<p>
Java代码 
1.sessionFactory.evict(Customer.class);  
sessionFactory.evict(Customer.class);
   evictCollection(String arg0)  将指定类的所有持久化对象的指定集合从二级缓存中清除,释放其占用的内存资源. 
</p>
   
<p>
Java代码 
1.sessionFactory.evictCollection("Customer.orders");  
sessionFactory.evictCollection("Customer.orders");
</p>

<p>
Hibernate的二级缓存的配置 
</p>

<p>
首先,不是所有的数据都适合放在二级缓存中,看一下,什么样的数据适合放在二级缓存中来?什么样的数据不适合放在二级缓存中来? 
  下面这几种情况就不适合加载到二级缓存中: 
  1.经常被修改的数据 
  2.绝对不允许出现并发访问的数据 
  3.与其他应用共享的数据 
  下面这己种情况合适加载到二级缓存中: 
  1.数据更新频率低 
  2.允许偶尔出现并发问题的非重要数据 
  3.不会被并发访问的数据 
  4.常量数据 
  5.不会被第三方修改的数据 
</p>

<p>
Hibernate的二级缓存功能是靠配置二级缓存插件来实现的,Hibernate为了集成这些插件,Hibernate提供了org.hibernate.cache.<a href="CacheProvider.html">CacheProvider</a>借口,它充当缓存插件与Hibernate之间的适配器 . 
</p>

<p>
常用的二级缓存插件 
EHCache  org.hibernate.cache.<a href="EhCacheProvider.html">EhCacheProvider</a> 
OSCache  org.hibernate.cache.<a href="OSCacheProvider.html">OSCacheProvider</a> 
<a href="SwarmCahe.html">SwarmCahe</a>  org.hibernate.cache.<a href="SwarmCacheProvider.html">SwarmCacheProvider</a> 
<a href="JBossCache.html">JBossCache</a>  org.hibernate.cache.<a href="TreeCacheProvider.html">TreeCacheProvider</a> 
</p>

<p>
简单介绍一下EHCache的配置 
hibernate.cfg.xml 
</p>

<p>
Xml代码 
1.&lt;hibernate-configuration&gt;  
2.   &lt;session-factory&gt;  
3.        
4.      &lt;property name="hibernate.cache.provider_class"&gt;  
5.         org.hibernate.cache.<a href="EhCacheProvider.html">EhCacheProvider</a>   
6.      &lt;/property&gt;  
7.        
8.      &lt;property name="hibernate.cache.use_query_cache"&gt;  
9.         true   
10.      &lt;/property&gt;  
11.   &lt;/session-factory&gt;  
12. &lt;/hibernate-configuration&gt;  
 &lt;hibernate-configuration&gt;
</p>
<blockquote>
&lt;session-factory&gt;
&lt;property name="hibernate.cache.provider_class"&gt;
org.hibernate.cache.<a href="EhCacheProvider.html">EhCacheProvider</a>
&lt;/property&gt;
&lt;property name="hibernate.cache.use_query_cache"&gt;
true
&lt;/property&gt;
&lt;/session-factory&gt;
</blockquote>
<p>
  &lt;/hibernate-configuration&gt;
</p>

<p>
ehcache.xml 
</p>


<p>
Xml代码 
1.&lt;ehcache&gt;  
2.    
3.  &lt;diskStore path="java.io.tmpdir"/&gt;  
4.    &lt;defaultCache maxElementsInMemory="10000" eternal="false"  timeToIdleSeconds="300" timeToLiveSeconds="600" overflowToDisk="true"/&gt;  
5.&lt;/ehcache&gt;  
&lt;ehcache&gt;
  &lt;diskStore path="java.io.tmpdir"/&gt;
</p>
<blockquote>
&lt;defaultCache maxElementsInMemory="10000" eternal="false"  timeToIdleSeconds="300" timeToLiveSeconds="600" overflowToDisk="true"/&gt;
</blockquote>
<p>
&lt;/ehcache&gt;
</p>


<p>
****.hbm.xml 
</p>


<p>
Xml代码 
1.&lt;?xml version="1.0" encoding='UTF-8'?&gt;  
2.&lt;!DOCTYPE hibernate-mapping PUBLIC   
3.                            "-//Hibernate/Hibernate Mapping DTD 3.0//EN"   
4.                            "<a href="http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd</a>" &gt;  
5.  
6.&lt;hibernate-mapping&gt;  
7.        
8.   &lt;class&gt;  
9.         
10.       &lt;cache usage="read-write"/&gt;       
11.   &lt;/class&gt;  
12.  
13.&lt;/hibernate-mapping&gt;  
</p>
        </div>
<div id="footer"><center>
            Copyright@2010 arch Powered by <a href="http://vimwiki.googlecode.com/">Vimwiki</a>
	 <script charset="Shift_JIS" src="http://chabudai.sakura.ne.jp/blogparts/honehoneclock/honehone_clock_wh.js"></script></center>
        </div>
    </body>
</html>
